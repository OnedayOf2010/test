<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <title>gnet-wechat-frame</title>
    <link href="wechatIframe.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div class="wrap" id="login_container">

    </div>
</body>
<script  type="text/javascript" src="jquery.js"></script>
<script type="text/javascript">
    window.showMsg =function(msg){
        $("#msg").html(msg);
    }
    function creatIframe(url,$dom){
        var el = document.createElement("iframe");
        el.width="300px";
        el.height="400px";
        el.scrolling="no";
        el.allowTransparency="true";
        el.frameBorder="0";
        el.src=url;
        $dom.append(el);
    }
    function getUrlParam(url,name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var search =url.substring(url.indexOf("?")+1);
        var r = search.match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    !function(a,b){function d(a){var e,c=b.createElement("iframe"),d="https://open.weixin.qq.com/connect/qrconnect?appid="+a.appid+"&scope="+a.scope+"&redirect_uri="+a.redirect_uri+"&state="+a.state+"&login_type=jssdk";d+=a.style?"&style="+a.style:"",d+=a.href?"&href="+a.href:"",c.src=d,c.frameBorder="0",c.allowTransparency="true",c.scrolling="no",c.width="300px",c.height="200px",e=b.getElementById(a.id),e.innerHTML="",e.appendChild(c)}a.WxLogin=d}(window,document);
    $.ajax({
        url:"https://uniform.quanshi.com/rest/user/login/getwxLoginUrl?yhy_p=d",
        type:"GET",
        dataType:"json",
        success:function(data){
            var url = data.result.loginUrl;
            url = url.replace("#wechat_redirect","");
            //自定义css地址
            var cssHref = "https://onedayof2010.github.io/test/wxtest1.css?"+Math.random();
//        url+="&login_type=jssdk&href="+cssHref;
//        creatIframe(url,$("#login_container"));
            var obj = new WxLogin({
                id:"login_container",
                appid: getUrlParam(url,"appid"),
                scope: "snsapi_login",
                redirect_uri: getUrlParam(url,"redirect_uri"),
                state: getUrlParam(url,"state"),
                style: "",
                href: cssHref
            });
        }
    })

</script>
</html>
